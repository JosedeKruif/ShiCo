{"version":3,"sources":["scripts/app-fd6dacb858.js"],"names":["angular","module","TrackerParametersService","getParameters","vm","parameters","setParameters","params","forEach","val","key","isDefined","updateYearKeys","yearValues","availableYears","values","idxYearFrom","from","idxYearTo","to","startKey","endKey","this","terms","maxTerms","maxRelatedTerms","minDist","wordBoost","forwards","sumDistances","algorithm","aggWeighFunction","aggWFParam","aggYearsInInterval","aggWordsPerYear","options","floor","ceil","step","onChange","service","trackerParameters","directive","scope","templateUrl","controllerAs","controller","TrackerParametersController","algorithms","weighFuncs","years","$inject","trackerGraphs","TrackerGraphsController","GraphControlService","yearsInSight","yearIdx","forceGraph","currYearIdx","addBorder","svg","attr","downloadData","rawData","getRawData","stream","allWords","Set","allYears","wordValues","year","push","weight","word","add","headers","concat","csvData","row","streamGraph","slider_options","getYearLabel","parameterIO","ParameterIOController","hide","readOnly","text","JSON","stringify","btnText","closeParamIO","parse","GraphConfigService","yearLabels","update","data","idx","setVocabulary","setStreamYears","streamData","formatForStream","forceData","formatForForce","networks","length","network","getConfig","showTicksValues","translate","vocab","wordColourIdx","getColour","item","name","cIdx","colours","getX","point","getY","tickY","tickVal","parseFloat","toFixed","tickYear","yearTickLabels","labels","processNode","node","addTextLabels","setSize","forceGraphHooks","hook","append","d","style","type","select","chooseSymbolType","chooseSymbolSize","Math","log2","count","customTooltipContent","showContent","html","addForceGraphHook","callback","graphName","streamConfig","forceConfig","chart","height","margin","top","right","bottom","left","x","y","xAxis","tickFormat","yAxis","color","customSymbol","d3","symbol","size","width","nodeExtras","curveLinks","useArrows","tooltip","contentGenerator","scale","category20","FormController","ConceptService","doPost","resp","trackConcept","trackerPromise","then","SettingsService","$resource","doLoad","configFile","get","$promise","config","baseURL","trackerURL","avlYearSvcURL","avlYearResource","first","last","$log","trackerParams","tracker","request","trackPromise","parseTermTrack","toJSON","runBlock","debug","run","$logProvider","toastrConfig","debugEnabled","allowHtml","timeOut","positionClass","preventDuplicates","progressBar","$templateCache","put"],"mappings":"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","file":"scripts/app-fd6dacb858.js","sourcesContent":["(function() {\n  'use strict';\n\n  angular\n    .module('shico', [\n      'ngResource',\n      'ngAnimate',\n      'ui.bootstrap',\n      'toastr',\n      'nvd3',\n      'rzModule',\n      'cgBusy',\n      'ngSanitize',\n      'ngCsv'\n    ]);\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('shico')\n    .service('TrackerParametersService', TrackerParametersService);\n\n  function TrackerParametersService() {\n    var vm = this;\n\n    vm.parameters = {\n      terms: '',\n      maxTerms: 10,\n      maxRelatedTerms: 10,\n      startKey: '',\n      endKey: '',\n      minDist: 0.1,\n      wordBoost: 1.0,\n      forwards: true,\n      sumDistances: false,\n      algorithm: 'adaptive',   //  'adaptive' or 'non-adaptive'\n      // Aggregator parameters:\n      aggWeighFunction: 'Gaussian',\n      aggWFParam: 1,\n      aggYearsInInterval: 1,\n      aggWordsPerYear: 5\n    };\n\n    vm.availableYears = {\n      from: 0, to: 1,\n      values: {},\n      options: {\n        floor: 0,\n        ceil: 1,\n        step: 1,\n        onChange: updateYearKeys\n      }\n    };\n\n    var service = {\n      getParameters: getParameters,\n      setParameters: setParameters,\n      availableYears: vm.availableYears\n    };\n    return service;\n\n    function getParameters() {\n      return vm.parameters;\n    }\n\n    function setParameters(params) {\n      // Copy parameters from `params` which already exist in `vm.parameters`\n      angular.forEach(vm.parameters, function(val,key) {\n        if(angular.isDefined(params[key])) {\n          vm.parameters[key] = params[key]\n        }\n      });\n    }\n\n    function updateYearKeys() {\n      // Copy values from slider to startKey and endKey\n      // Slider contains only year (e.g. 1954), while startKey and endKey\n      // require the name of the corresponding w2v model (e.g. 1950_1959)\n      var yearValues = vm.availableYears.values;\n      var idxYearFrom = vm.availableYears.from;\n      var idxYearTo = vm.availableYears.to;\n\n      vm.parameters.startKey = yearValues[idxYearFrom];\n      vm.parameters.endKey   = yearValues[idxYearTo];\n    }\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('shico')\n    .directive('trackerParameters', trackerParameters);\n\n  function trackerParameters() {\n      var directive = {\n          scope: {},    // Directive has it's own personal scope\n          templateUrl: '/app/components/shico/trackerParameters.template.html',\n          controllerAs: 'vm',\n          controller: 'TrackerParametersController'\n      };\n      return directive;\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('shico')\n    .controller('TrackerParametersController', TrackerParametersController);\n\n  function TrackerParametersController(TrackerParametersService) {\n    var vm = this;\n    vm.algorithms = ['adaptive', 'non-adaptive'];\n    vm.weighFuncs = ['Gaussian', 'Linear', 'JSD'];\n    // Years not defined  here because it gets loaded by service\n    vm.years = TrackerParametersService.availableYears;\n\n    // We use the parameters variable from ParameterService directly.\n    vm.parameters = TrackerParametersService.getParameters();\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('shico')\n    .directive('trackerGraphs', trackerGraphs);\n\n  function trackerGraphs() {\n    var directive = {\n      scope: {},    // Directive has it's own personal scope\n      templateUrl: '/app/components/shico/trackerGraphs.template.html',\n      controllerAs: 'vm',\n      controller: 'TrackerGraphsController'\n    };\n    return directive;\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('shico')\n    .controller('TrackerGraphsController', TrackerGraphsController);\n\n  function TrackerGraphsController(GraphControlService) {\n    var vm = this;\n\n    // Share graph data from service to controller\n    // so directive can find them.\n    vm.streamGraph = GraphControlService.streamGraph;\n    vm.forceGraph = GraphControlService.forceGraph;\n    vm.slider_options = GraphControlService.slider_options;\n    vm.getYearLabel = GraphControlService.getYearLabel;\n    vm.yearsInSight = yearsInSight;\n    vm.addBorder = addBorder;\n    vm.downloadData = downloadData;\n\n    function yearsInSight(yearIdx) {\n      return (vm.forceGraph.currYearIdx - 2) <= yearIdx &&\n              yearIdx < (vm.forceGraph.currYearIdx + 2);\n    }\n\n    function addBorder(scope) {\n      // Add border\n      scope.svg.attr('style', 'border-style: solid');\n    }\n\n    function downloadData() {\n      var rawData = GraphControlService.getRawData().stream;\n\n      // allWords and allYears we already had -- we shouldn't need to build them again\n      var allWords = new Set();\n      var allYears = [];\n      angular.forEach(rawData, function(wordValues, year) {\n        allYears.push(year);\n        angular.forEach(wordValues, function(weight, word) {\n          allWords.add(word);\n        });\n      });\n\n      // Create CSV file\n      var headers = [ '' ].concat(allYears);\n      var csvData = [ headers ];\n      angular.forEach(allWords, function(word) {\n        var row = [ word ];\n        angular.forEach(allYears, function(year) {\n          var val = (word in rawData[year]) ? rawData[year][word] : 0;\n          row.push(val);\n        });\n        csvData.push(row);\n      });\n\n      return csvData;\n    }\n  }\n})();\n\n(function() {\n  'use strict';\n\n//  console.log('Running temp code...');\n\n//  var shico = angular\n//      .module('shico');\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('shico')\n    .directive('parameterIo', parameterIO);\n\n  function parameterIO() {\n      var directive = {\n          scope: {},    // Directive has it's own personal scope\n          templateUrl: '/app/components/shico/parameterIO.template.html',\n          controllerAs: 'vm',\n          controller: 'ParameterIOController'\n      };\n      return directive;\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('shico')\n    .controller('ParameterIOController', ParameterIOController);\n\n  function ParameterIOController(TrackerParametersService) {\n    var vm = this;\n    vm.getParameters = getParameters;\n    vm.setParameters = setParameters;\n    vm.closeParamIO = closeParamIO;\n\n    vm.text = '';\n    vm.readOnly = false;\n    vm.hide = true;\n\n    function getParameters () {\n      vm.hide = false;\n      vm.readOnly = true;\n      vm.text = JSON.stringify(TrackerParametersService.getParameters());\n      vm.btnText = 'Ok';\n    }\n\n    function setParameters () {\n      vm.hide = false;\n      vm.readOnly = false;\n      vm.text = '';\n      vm.btnText = 'Load';\n    }\n\n    function closeParamIO() {\n      vm.hide = true;\n      if(!vm.readOnly) {\n        var params = JSON.parse(vm.text);\n        TrackerParametersService.setParameters(params);\n      }\n    }\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n      .module('shico')\n      .service('GraphControlService', GraphControlService);\n\n  function GraphControlService(GraphConfigService) {\n    var vm = this;\n\n    vm.streamGraph = {\n      options: GraphConfigService.getConfig('streamGraph'),\n      data:    []\n    };\n\n    vm.forceGraph = {\n      options: GraphConfigService.getConfig('forceGraph'),\n      data: [],\n      currYearIdx: 0\n    };\n\n    vm.yearLabels = [];\n    vm.slider_options = {\n      floor: 0,\n      ceil: 0,\n      showTicksValues: false,\n      translate: getYearLabel\n    };\n\n    var service = {\n      update: update,\n      getRawData: getRawData,\n      getYearLabel: getYearLabel,\n      streamGraph: vm.streamGraph,\n      forceGraph:  vm.forceGraph,\n      slider_options: vm.slider_options\n\n    };\n    return service;\n\n    function getYearLabel(yearIdx) {\n      return vm.yearLabels[yearIdx];\n    }\n\n    // Update graphs with the given data\n    function update(data) {\n      vm.rawData = data;\n\n      // Collect all words and year labels on data\n      var allYears = [];\n      var allWords = new Set();\n      angular.forEach(data.stream, function(wordValues, year) {\n        allYears.push(year);\n        angular.forEach(wordValues, function(weight, word) {\n          allWords.add(word);\n        });\n      });\n\n      // Create year idx -> label table\n      var yearIdx = {};\n      angular.forEach(allYears, function(year, idx) {\n        yearIdx[year] = idx;\n      });\n\n      // Register vocabulary and year labels with to be used by config\n      GraphConfigService.setVocabulary(allWords);\n      GraphConfigService.setStreamYears(allYears);\n      vm.yearLabels = allYears;\n\n      // Prepare data on format suitable from NVD3\n      var streamData = formatForStream(data.stream, yearIdx, allWords, allYears);\n      var forceData  = formatForForce(data.networks, yearIdx);\n\n      // Register data on graph\n      vm.streamGraph.data = streamData;\n      vm.forceGraph.data = forceData;\n\n      vm.slider_options.ceil = vm.yearLabels.length-1;\n    }\n\n    function getRawData() {\n      return vm.rawData;\n    }\n\n    function formatForStream(data, yearIdx, allWords, allYears) {\n      var streamData = [];\n      angular.forEach(allWords, function(word) {\n        var values = [];\n        angular.forEach(allYears, function(year) {\n          var val = (word in data[year]) ? data[year][word] : 0;\n          this.push([ yearIdx[year], val]);\n        }, values);\n        this.push({\n          key: word,\n          values: values\n        });\n      }, streamData);\n      return streamData;\n    }\n\n    function formatForForce(data, yearIdx) {\n      var forceData = {};\n\n      angular.forEach(data, function(network, year) {\n        forceData[yearIdx[year]] = network;\n      });\n\n      return forceData;\n    }\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n      .module('shico')\n      .service('GraphConfigService', GraphConfigService);\n\n  function GraphConfigService() {\n    // NVD3 configuration for stream graph\n    var streamConfig = {\n      chart: {\n          type: 'stackedAreaChart',\n          height: 500,\n          margin : {\n              top: 0,\n              right: 0,\n              bottom: 0,\n              left: 0\n          },\n          x: getX,\n          y: getY,\n          xAxis: {\n            tickFormat: tickYear\n          },\n          yAxis: {\n            tickFormat: tickY\n          },\n          color: getColour\n      }\n    };\n\n    var customSymbol = d3.svg.symbol()\n                .type( chooseSymbolType )\n                .size( chooseSymbolSize );\n\n    // NVD3 configuration for force directed graph\n    var forceConfig = {\n      chart: {\n          type: 'forceDirectedGraph',\n          height: 300,\n          width: 300,\n          color: getColour,\n          symbol: customSymbol,\n          nodeExtras: processNode,\n          curveLinks:  true,\n          useArrows: true,\n          tooltip: { contentGenerator: customTooltipContent }\n      }\n    };\n    var colours = d3.scale.category20();\n\n    var yearTickLabels = {};   // Year markers for stream graph\n    var forceGraphHooks = [];\n    var wordColourIdx = {};\n\n    var service = {\n      getConfig: getConfig,\n      setStreamYears: setStreamYears,\n      addForceGraphHook: addForceGraphHook,\n      setVocabulary: setVocabulary\n    };\n    return service;\n\n    // Helper functions for all graphs\n    function setVocabulary(vocab) {\n      var idx = 0;\n      // Each word of vocabulary is assigned an unique ID, later used to assign colour\n      // TODO: can't we get a list of words from server?\n      angular.forEach(vocab, function(word) {\n        wordColourIdx[word] = idx;\n        idx += 1;\n      });\n    }\n\n    function getColour(item) {\n      var word = item.key || item.name;\n      var cIdx = wordColourIdx[word];\n      return cIdx ? colours(cIdx) : '#223344';\n    }\n\n    // Helper functions for streamConfig\n    function getX(point){ return point[0]; }\n    function getY(point){ return point[1]; }\n    function tickY(tickVal) { return parseFloat(tickVal).toFixed(1); }\n\n    function tickYear(idx) {\n      if(idx in yearTickLabels) { return yearTickLabels[idx]; }\n      else { return idx; }\n    }\n    function setStreamYears(labels) {\n      yearTickLabels = labels;\n    }\n\n    // Helper functions for forceConfig\n    function processNode(node) {\n      // Nodes have: {'name': 'str', 'type': 'seed', 'count': N},\n      addTextLabels(node);\n      setSize(node);\n      angular.forEach(forceGraphHooks, function(hook) {\n        hook(node);\n      });\n    }\n\n    function addTextLabels(node) {\n      node.append(\"text\")\n        .attr(\"dx\", 12)\n        .attr(\"dy\", \".35em\")\n        .text(function(d) { return d.name; })\n        .style(\"font-weight\", function(d) { return d.type==\"seed\"?\"bold\":\"\"; });\n    }\n\n    function setSize(node) {\n      node.select('circle')\n        .attr('r', function(d) { return 5 + 2 * (d.count); });\n    }\n\n    function chooseSymbolType(d) {\n      if (d.type==\"seed\") {\n        return \"triangle-up\";\n      } else if(d.type==\"word\") {\n        return \"circle\";\n      } else {\n        return \"diamond\";\n      }\n    }\n\n    function chooseSymbolSize(d) {\n      return 50 * Math.log2(2 + d.count);\n    }\n\n    function customTooltipContent(d) {\n      var showContent = [ 'type', 'count', 'weight' ];\n\n      var html = '<table>';\n      html += '<thead><tr><td colspan=\"2\"><strong class=\"x-value\">' + d['name'] + '</strong></td></tr></thead>';\n      html += '<tbody>';\n\n      angular.forEach(showContent, function(key) {\n        html += '<tr>';\n        html += '<td class=\"key\">' + key + '</td>';\n        html += '<td class=\"value\">' + d[key] + '</td>';\n        html += '</tr>';\n      });\n\n      html += '</tbody>';\n      html += '</table>';\n      return html;\n    }\n\n    function addForceGraphHook(callback) {\n      forceGraphHooks.push(callback);\n    }\n\n    function getConfig(graphName) {\n      if(graphName === 'streamGraph') {\n        return streamConfig;\n      } else if(graphName === 'forceGraph'){\n        return forceConfig;\n      }\n    }\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n      .module('shico')\n      .controller('FormController', FormController);\n\n  function FormController(ConceptService,\n                          TrackerParametersService,\n                          GraphControlService) {\n    var vm = this;\n\n    vm.doPost = doPost;\n\n    function doPost() {\n      var params = TrackerParametersService.getParameters();\n      var resp = ConceptService.trackConcept(params);\n      vm.trackerPromise = resp; // ng-busy watches on trackerPromise\n      resp.then(GraphControlService.update);\n    }\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n      .module('shico')\n      .service('SettingsService', SettingsService);\n\n  function SettingsService($resource, TrackerParametersService) {\n    var service = {\n      doLoad: doLoad\n    };\n    return service;\n\n    function doLoad() {\n      var configFile = $resource('config.json');\n      configFile.get().$promise.then(function(config) {\n        var baseURL = config.baseURL;\n        var trackerURL = baseURL + '/track/:terms';\n        var avlYearSvcURL = baseURL + '/available-years';\n\n        if(baseURL.length==0) {\n          trackerURL = 'dummy2.json';\n          avlYearSvcURL = 'http://localhost:5000/available-years';\n        }\n\n        // Copy config from JSON to the service\n        service.trackerURL = trackerURL;\n\n        // Call avlYearSvc resource to get years\n        var avlYearResource = $resource(avlYearSvcURL);\n        avlYearResource.get().$promise.then(function(years) {\n          TrackerParametersService.availableYears.from = years.first;\n          TrackerParametersService.availableYears.to = years.last;\n          TrackerParametersService.availableYears.values = years.values;\n          TrackerParametersService.availableYears.options.floor = years.first;\n          TrackerParametersService.availableYears.options.ceil = years.last;\n        });\n      });\n    }\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n      .module('shico')\n      .service('ConceptService', ConceptService);\n\n  function ConceptService($resource, $log, SettingsService) {\n    var service = {\n      trackConcept: trackConcept\n    };\n    return service;\n\n    function trackConcept(trackerParams) {\n      // trackerURL format: http://localhost:5000/track/:terms\n      var tracker = $resource(SettingsService.trackerURL);\n      var request = tracker.get(trackerParams);\n      var trackPromise = request.$promise.then(parseTermTrack);\n      return trackPromise;\n    }\n\n    function parseTermTrack(data) {\n      // If data needs to be parsed, it should be done here.\n      return data.toJSON();\n    }\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('shico')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock($log, SettingsService) {\n    $log.debug('runBlock end');\n    SettingsService.doLoad();\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('shico');\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('shico')\n    .config(config);\n\n  /** @ngInject */\n  function config($logProvider, toastrConfig) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n\n    // Set options third-party lib\n    toastrConfig.allowHtml = true;\n    toastrConfig.timeOut = 3000;\n    toastrConfig.positionClass = 'toast-top-right';\n    toastrConfig.preventDuplicates = true;\n    toastrConfig.progressBar = true;\n  }\n})();\n\nangular.module(\"shico\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/components/shico/parameterIO.template.html\",\"<div class=\\\"row\\\"><div class=\\\"col-md-2\\\"><button ng-click=\\\"vm.getParameters()\\\" class=\\\"btn btn-success\\\">Save parameters</button></div><div class=\\\"col-md-2\\\"><button ng-click=\\\"vm.setParameters()\\\" class=\\\"btn btn-success\\\">Load parameters</button></div></div><br><div class=\\\"row\\\" ng-hide=\\\"vm.hide\\\"><div class=\\\"col-md-8\\\"><textarea class=\\\"form-control\\\" rows=\\\"2\\\" ng-readonly=\\\"vm.readOnly\\\" ng-model=\\\"vm.text\\\"></textarea></div><div class=\\\"col-md-2\\\"><button ng-click=\\\"vm.closeParamIO()\\\" class=\\\"btn btn-success\\\">{{ vm.btnText }}</button></div></div>\");\n$templateCache.put(\"app/components/shico/trackerGraphs.template.html\",\"<div class=\\\"row\\\" ng-if=\\\"vm.forceGraph.data.length != 0\\\"><div class=\\\"row col-md-12\\\"><nvd3 data=\\\"vm.streamGraph.data\\\" options=\\\"vm.streamGraph.options\\\"></nvd3></div><div class=\\\"row col-md-12\\\"><div class=\\\"col-md-3\\\" ng-repeat=\\\"(yearIdx,yearData) in vm.forceGraph.data\\\" ng-if=\\\"vm.yearsInSight(yearIdx)\\\"><span class=\\\"label label-default\\\">{{ vm.getYearLabel(yearIdx) }}</span><nvd3 data=\\\"yearData\\\" options=\\\"vm.forceGraph.options\\\" on-ready=\\\"vm.addBorder\\\"></nvd3></div><rzslider ng-hide=\\\"!vm.slider_options.ceil\\\" rz-slider-model=\\\"vm.forceGraph.currYearIdx\\\" rz-slider-options=\\\"vm.slider_options\\\"></rzslider></div><div class=\\\"row col-md-12 pager\\\"><button class=\\\"btn btn-success\\\" ng-csv=\\\"vm.downloadData()\\\" filename=\\\"test.csv\\\">Save data</button></div></div>\");\n$templateCache.put(\"app/components/shico/trackerParameters.template.html\",\"<div class=\\\"row form-horizontal col-md-12\\\"><p class=\\\"lead\\\">Concept search</p><div class=\\\"form-group col-md-11\\\"><input type=\\\"text\\\" ng-model=\\\"vm.parameters.terms\\\" class=\\\"form-control\\\" id=\\\"terms\\\" placeholder=\\\"Search concepts\\\"></div><div class=\\\"form-group col-md-1\\\"><button type=\\\"button\\\" class=\\\"btn btn-primary\\\" ng-click=\\\"isOpen = !isOpen\\\">+</button></div><div uib-collapse=\\\"!isOpen\\\"><div><div class=\\\"form-group form-inline col-md-4\\\"><label for=\\\"maxConcepts\\\">Max terms</label> <input type=\\\"number\\\" ng-model=\\\"vm.parameters.maxTerms\\\" min=\\\"1\\\" max=\\\"20\\\" class=\\\"form-control\\\" id=\\\"maxConcepts\\\"></div><div class=\\\"form-group form-inline col-md-4\\\"><label for=\\\"maxRelatedTerms\\\">Max related terms</label> <input type=\\\"number\\\" ng-model=\\\"vm.parameters.maxRelatedTerms\\\" min=\\\"1\\\" max=\\\"20\\\" class=\\\"form-control\\\" id=\\\"maxRelatedTerms\\\"></div><div class=\\\"form-group form-inline col-md-4\\\"><label for=\\\"minDist\\\">Minimum concept distance</label> <input type=\\\"number\\\" ng-model=\\\"vm.parameters.minDist\\\" min=\\\"0.1\\\" max=\\\"10.0\\\" step=\\\"0.1\\\" class=\\\"form-control\\\" id=\\\"minDist\\\"></div><div class=\\\"form-group form-inline col-md-4\\\"><label for=\\\"wordBoost\\\">Word boost</label> <input type=\\\"number\\\" ng-model=\\\"vm.parameters.wordBoost\\\" min=\\\"0.1\\\" max=\\\"10.0\\\" step=\\\"0.1\\\" class=\\\"form-control\\\" id=\\\"wordBoost\\\"></div><div class=\\\"form-group form-inline col-md-4\\\"><label for=\\\"sumDistances\\\">Sum distances</label> <input type=\\\"checkbox\\\" ng-model=\\\"vm.parameters.sumDistances\\\" class=\\\"form-control\\\" id=\\\"sumDistances\\\"></div><div class=\\\"form-group form-inline col-md-4\\\"><label for=\\\"algorithm\\\">Algorithm:</label><select ng-model=\\\"vm.parameters.algorithm\\\" name=\\\"algorithm\\\"><option data-ng-repeat=\\\"algo in vm.algorithms\\\" value=\\\"{{ algo }}\\\">{{ algo }}</option></select></div><div class=\\\"form-group col-md-12\\\"><label for=\\\"forward\\\">Track direction</label><div class=\\\"radio\\\"><label><input type=\\\"radio\\\" ng-model=\\\"vm.parameters.forwards\\\" ng-value=\\\"true\\\" id=\\\"forward\\\"> Forwards</label></div><div class=\\\"radio\\\"><label><input type=\\\"radio\\\" ng-model=\\\"vm.parameters.forwards\\\" ng-value=\\\"false\\\" id=\\\"forward\\\"> Backwards</label></div></div><div class=\\\"form-group form-inline col-md-4\\\"><label for=\\\"yearsInterval\\\">Years in interval</label> <input type=\\\"number\\\" ng-model=\\\"vm.parameters.aggYearsInInterval\\\" min=\\\"1\\\" max=\\\"10\\\" step=\\\"1\\\" class=\\\"form-control\\\" id=\\\"yearsInterval\\\"></div><div class=\\\"form-group form-inline col-md-4\\\"><label for=\\\"wordsPerYear\\\">Words per year</label> <input type=\\\"number\\\" ng-model=\\\"vm.parameters.aggWordsPerYear\\\" min=\\\"1\\\" max=\\\"100\\\" step=\\\"1\\\" class=\\\"form-control\\\" id=\\\"wordsPerYear\\\"></div><div class=\\\"form-group form-inline col-md-4\\\"><label for=\\\"aggWeighFunc\\\">Weighing function</label><select ng-model=\\\"vm.parameters.aggWeighFunction\\\" name=\\\"aggWeighFunc\\\"><option data-ng-repeat=\\\"wFunc in vm.weighFuncs\\\" value=\\\"{{ wFunc }}\\\">{{ wFunc }}</option></select></div><div class=\\\"form-group form-inline col-md-4\\\"><label for=\\\"aggWFParam\\\">Weighing function parameter</label> <input type=\\\"number\\\" ng-model=\\\"vm.parameters.aggWFParam\\\" min=\\\"1\\\" max=\\\"10\\\" step=\\\"0.1\\\" class=\\\"form-control\\\" id=\\\"aggWFParam\\\"></div></div><div class=\\\"form-group col-md-11\\\">Year period:<rzslider rz-slider-model=\\\"vm.years.from\\\" rz-slider-high=\\\"vm.years.to\\\" rz-slider-options=\\\"vm.years.options\\\"></rzslider></div></div></div>\");}]);"],"sourceRoot":"/source/"}